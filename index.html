<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico - Quemador Solana</title>
    <style>
        body { 
            background: #111; 
            color: white; 
            font-family: Arial, sans-serif; 
            padding: 20px; 
        }
        .card {
            background: #222;
            border-radius: 10px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
        }
        h1 { color: #00FFFF; }
        button {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #444; }
        #error, #success {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }
        #error { background: rgba(255,0,0,0.2); border: 1px solid #ff6666; }
        #success { background: rgba(0,255,0,0.2); border: 1px solid #66ff66; }
        .log { 
            background: #000; 
            padding: 10px; 
            border-radius: 5px; 
            margin-top: 10px;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-entry { margin: 5px 0; }
        .error { color: #ff6666; }
        .success { color: #66ff66; }
        .info { color: #6666ff; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Diagnóstico del Quemador</h1>
        <p>Esta página ayuda a identificar por qué no funciona el quemador de tokens.</p>
        
        <div id="error"></div>
        <div id="success"></div>
        
        <h2>Pruebas:</h2>
        <button id="test-js">1. Probar JavaScript</button>
        <button id="test-libs">2. Probar carga de bibliotecas</button>
        <button id="test-phantom">3. Probar Phantom</button>
        <button id="test-solflare">4. Probar Solflare</button>
        
        <h2>Log:</h2>
        <div class="log" id="log"></div>
    </div>

    <script>
        // Elementos DOM
        const errorEl = document.getElementById('error');
        const successEl = document.getElementById('success');
        const logEl = document.getElementById('log');
        
        // Funciones de log
        function showError(message) {
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            successEl.style.display = 'none';
            log('error', message);
        }
        
        function showSuccess(message) {
            successEl.textContent = message;
            successEl.style.display = 'block';
            errorEl.style.display = 'none';
            log('success', message);
        }
        
        function log(type, message) {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // Prueba 1: JavaScript básico
        document.getElementById('test-js').addEventListener('click', function() {
            try {
                log('info', 'Probando JavaScript básico...');
                // Simple prueba de JS
                const test = 1 + 1;
                if (test === 2) {
                    showSuccess('JavaScript funciona correctamente');
                } else {
                    showError('Error inesperado en JavaScript');
                }
            } catch (e) {
                showError('Error en JavaScript: ' + e.message);
            }
        });
        
        // Prueba 2: Cargar bibliotecas
        document.getElementById('test-libs').addEventListener('click', function() {
            log('info', 'Probando carga de bibliotecas...');
            
            // Cargar Solana Web3
            const script1 = document.createElement('script');
            script1.src = 'https://unpkg.com/@solana/web3.js@1.73.0/lib/index.iife.min.js';
            script1.onload = function() {
                log('success', 'Biblioteca Solana Web3.js cargada correctamente');
                
                // Cargar SPL Token
                const script2 = document.createElement('script');
                script2.src = 'https://unpkg.com/@solana/spl-token@0.3.6/lib/index.iife.min.js';
                script2.onload = function() {
                    log('success', 'Biblioteca SPL Token cargada correctamente');
                    
                    // Verificar objetos globales
                    if (typeof solanaWeb3 !== 'undefined' && typeof splToken !== 'undefined') {
                        showSuccess('Ambas bibliotecas cargadas y disponibles');
                        
                        // Probar conexión a Solana
                        try {
                            const connection = new solanaWeb3.Connection(
                                'https://api.mainnet-beta.solana.com',
                                'confirmed'
                            );
                            connection.getVersion()
                                .then(version => {
                                    log('success', 'Conexión a Solana establecida: ' + JSON.stringify(version));
                                })
                                .catch(err => {
                                    log('error', 'Error al conectar con Solana: ' + err.message);
                                });
                        } catch (e) {
                            log('error', 'Error al crear conexión: ' + e.message);
                        }
                    } else {
                        showError('Bibliotecas cargadas pero no disponibles globalmente');
                    }
                };
                
                script2.onerror = function() {
                    showError('Error al cargar biblioteca SPL Token');
                };
                
                document.body.appendChild(script2);
            };
            
            script1.onerror = function() {
                showError('Error al cargar biblioteca Solana Web3.js');
            };
            
            document.body.appendChild(script1);
        });
        
        // Prueba 3: Phantom Wallet
        document.getElementById('test-phantom').addEventListener('click', function() {
            log('info', 'Probando Phantom Wallet...');
            
            if (typeof window.solana !== 'undefined') {
                log('success', 'Extensión Phantom detectada');
                
                if (window.solana.isPhantom) {
                    log('success', 'Phantom Wallet confirmado');
                    
                    // Probar conexión
                    log('info', 'Intentando conectar...');
                    window.solana.connect({ onlyIfTrusted: false })
                        .then(resp => {
                            const address = resp.publicKey.toString();
                            log('success', `Conectado exitosamente a: ${address.substring(0, 6)}...${address.substring(address.length - 4)}`);
                            showSuccess('Phantom Wallet funciona correctamente');
                        })
                        .catch(err => {
                            log('error', 'Error al conectar: ' + err.message);
                            showError('Error al conectar con Phantom: ' + err.message);
                        });
                } else {
                    log('error', 'Objeto solana existe pero no es Phantom');
                    showError('Objeto solana detectado pero no es Phantom');
                }
            } else {
                log('error', 'Phantom Wallet no detectado');
                showError('Phantom Wallet no está instalado');
            }
        });
        
        // Prueba 4: Solflare Wallet
        document.getElementById('test-solflare').addEventListener('click', function() {
            log('info', 'Probando Solflare Wallet...');
            
            if (typeof window.solflare !== 'undefined') {
                log('success', 'Extensión Solflare detectada');
                
                // Probar conexión
                log('info', 'Intentando conectar...');
                window.solflare.connect()
                    .then(() => {
                        const address = window.solflare.publicKey.toString();
                        log('success', `Conectado exitosamente a: ${address.substring(0, 6)}...${address.substring(address.length - 4)}`);
                        showSuccess('Solflare Wallet funciona correctamente');
                    })
                    .catch(err => {
                        log('error', 'Error al conectar: ' + err.message);
                        showError('Error al conectar con Solflare: ' + err.message);
                    });
            } else {
                log('error', 'Solflare Wallet no detectado');
                showError('Solflare Wallet no está instalado');
            }
        });
        
        // Mensaje inicial
        log('info', 'Página de diagnóstico cargada. Haz clic en los botones para probar cada componente.');
    </script>
</body>
</html>
