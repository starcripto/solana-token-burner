<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quemador de Tokens Solana</title>
    <!-- Estilos básicos primero -->
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: black;
            color: white;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .panel {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            min-width: 300px;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .title {
            color: #00FFFF;
            font-size: 36px;
            font-weight: bold;
        }
        .button {
            background-color: transparent;
            border: 1px solid;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        .phantom-button {
            color: #00FFFF;
            border-color: #00FFFF;
        }
        .solflare-button {
            color: #FFA500;
            border-color: #FFA500;
        }
        .error-message {
            background-color: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff5555;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
    
    <!-- Scripts necesarios -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
</head>
<body>
    <!-- Contenedor principal -->
    <div id="root">
        <!-- Este mensaje desaparecerá cuando React se cargue correctamente -->
        <div style="text-align: center; padding-top: 100px; color: white;">
            Cargando la aplicación...
        </div>
    </div>

    <script type="text/babel">
        // Asegurarse de que las bibliotecas estén accesibles
        const solanaWeb3 = window.solanaWeb3;
        const splToken = window.splToken;

        function App() {
            const [wallet, setWallet] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [selectedTokens, setSelectedTokens] = React.useState([]);
            const [availableTokens, setAvailableTokens] = React.useState([]);
            const [lastUpdated, setLastUpdated] = React.useState(null);

            // Función simplificada para conectar wallet
            const handleConnect = async (type) => {
                setLoading(true);
                setError(null);
                
                try {
                    // Verificar si el wallet está instalado
                    if (type === "phantom" && !window?.solana?.isPhantom) {
                        throw new Error("Por favor instala Phantom wallet");
                    }
                    if (type === "solflare" && !window?.solflare) {
                        throw new Error("Por favor instala Solflare wallet");
                    }
                    
                    let provider;
                    let publicKey;
                    
                    // Obtener proveedor según el tipo de wallet
                    if (type === "phantom") {
                        provider = window.solana;
                    } else {
                        provider = window.solflare;
                    }
                    
                    // Intentar conectar
                    try {
                        if (!provider.isConnected) {
                            const res = await provider.connect();
                            publicKey = res.publicKey || provider.publicKey;
                        } else {
                            publicKey = provider.publicKey;
                        }
                    } catch (e) {
                        throw new Error(`Error al conectar: ${e.message}`);
                    }
                    
                    if (!publicKey) {
                        throw new Error("No se pudo obtener la clave pública");
                    }
                    
                    // Wallet conectado exitosamente
                    const address = publicKey.toString();
                    setWallet({
                        address,
                        type,
                        publicKey
                    });
                    
                    // Simular tokens para prueba
                    setAvailableTokens([
                        { mint: 'So11111111111111111111111111111111111111112', symbol: 'SOL', balance: '0.25', decimals: 9 },
                        { mint: '8EoML7gaBJsgn1kLUCiPi7v4GJ2bFQUz6SCJ4X2X1Axw', symbol: 'BONK', balance: '1250000', decimals: 5 }
                    ]);
                    
                    setLastUpdated(new Date().toLocaleTimeString());
                    
                } catch (err) {
                    console.error("Error:", err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1 className="title">QUEMADOR DE TOKENS SOLANA</h1>
                        <p>Conecta tu wallet para empezar</p>
                    </div>
                    
                    {error && <div className="error-message">{error}</div>}
                    
                    <div className="grid">
                        <div className="panel">
                            <h2 style={{color: '#ff00ff'}}>Estado del Wallet</h2>
                            
                            {wallet ? (
                                <div>
                                    <p>Conectado: {wallet.address.slice(0, 6)}...{wallet.address.slice(-4)}</p>
                                    <p>Tipo: {wallet.type}</p>
                                    <button 
                                        onClick={() => setWallet(null)}
                                        style={{color: 'red', borderColor: 'red'}}
                                        className="button"
                                    >
                                        Desconectar
                                    </button>
                                </div>
                            ) : (
                                <div>
                                    <button 
                                        onClick={() => handleConnect("phantom")}
                                        disabled={loading}
                                        className="button phantom-button"
                                    >
                                        {loading ? "Conectando..." : "Conectar Phantom"}
                                    </button>
                                    <button 
                                        onClick={() => handleConnect("solflare")}
                                        disabled={loading}
                                        className="button solflare-button"
                                        style={{marginTop: '10px'}}
                                    >
                                        {loading ? "Conectando..." : "Conectar Solflare"}
                                    </button>
                                </div>
                            )}
                        </div>
                        
                        <div className="panel">
                            <h2 style={{color: '#00ff00'}}>Tokens Disponibles</h2>
                            
                            {loading ? (
                                <p>Cargando tokens...</p>
                            ) : wallet ? (
                                availableTokens.length > 0 ? (
                                    <div>
                                        <div style={{maxHeight: '300px', overflowY: 'auto'}}>
                                            {availableTokens.map(token => (
                                                <div key={token.mint} style={{padding: '10px', border: '1px solid #333', marginBottom: '5px', borderRadius: '5px'}}>
                                                    <label style={{display: 'flex', alignItems: 'center'}}>
                                                        <input 
                                                            type="checkbox"
                                                            checked={selectedTokens.includes(token.mint)}
                                                            onChange={(e) => {
                                                                if (e.target.checked) {
                                                                    setSelectedTokens([...selectedTokens, token.mint]);
                                                                } else {
                                                                    setSelectedTokens(selectedTokens.filter(t => t !== token.mint));
                                                                }
                                                            }}
                                                            style={{marginRight: '10px'}}
                                                        />
                                                        {token.symbol} - {token.balance}
                                                    </label>
                                                </div>
                                            ))}
                                        </div>
                                        
                                        <button 
                                            disabled={selectedTokens.length === 0 || loading}
                                            onClick={() => alert("Función de quemado simulada")}
                                            className="button"
                                            style={{marginTop: '10px', color: '#ff0000', borderColor: '#ff0000'}}
                                        >
                                            {`Quemar ${selectedTokens.length} Token${selectedTokens.length !== 1 ? "s" : ""}`}
                                        </button>
                                    </div>
                                ) : (
                                    <p>No se encontraron tokens en este wallet</p>
                                )
                            ) : (
                                <p>Conecta tu wallet para ver tus tokens</p>
                            )}
                            
                            {lastUpdated && (
                                <p style={{fontSize: '12px', color: '#666', marginTop: '10px'}}>
                                    Última actualización: {lastUpdated}
                                </p>
                            )}
                        </div>
                    </div>
                    
                    <footer style={{textAlign: 'center', marginTop: '40px', color: '#666'}}>
                        Ejecutando en Solana Mainnet • {new Date().getFullYear()}
                    </footer>
                </div>
            );
        }

        // Montar el componente con un try-catch para capturar errores
        try {
            const container = document.getElementById('root');
            const root = ReactDOM.createRoot(container);
            root.render(<App />);
            console.log("Aplicación montada correctamente");
        } catch (error) {
            console.error("Error al montar la aplicación:", error);
            document.getElementById('root').innerHTML = `
                <div style="text-align: center; padding: 20px; color: red;">
                    Error al cargar la aplicación: ${error.message}
                </div>
            `;
        }
    </script>
</body>
</html>
